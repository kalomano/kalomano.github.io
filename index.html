<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Estudiar</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
      background-color: #f9f9f9;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      margin-top: 1rem;
    }
    .chat {
      margin-top: 2rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .msg {
      margin: 1rem 0;
    }
    .msg strong {
      display: block;
      margin-bottom: 0.3rem;
    }
    .msg.bot {
      text-align: left;
    }
    .msg.user {
      text-align: right;
    }
  </style>
</head>
<body>
  <h1>🧠 Estudiar</h1>
  <button onclick="comenzarConversacion()">Comenzar</button>

  <div class="chat" id="chat"></div>

  <script>
    const preguntas = [
      "¿Qué es la fotosíntesis?",
      "¿Quién escribió Don Quijote?",
      "¿Cuál es la capital de Francia?",
      "¿Qué es una variable en programación?",
      "¿Cuántos planetas hay en el sistema solar?"
    ];

    let indicePregunta = 0;
    let escuchando = false;

    function agregarMensaje(texto, tipo = "bot") {
      const div = document.createElement("div");
      div.className = `msg ${tipo}`;
      div.innerHTML = `<strong>${tipo === "bot" ? "📚 Pregunta" : "🙋 Tú"}:</strong> ${texto}`;
      document.getElementById("chat").appendChild(div);
      document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
    }

    function hablar(texto, callback) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(texto);
      utter.lang = 'es-ES';
      utter.onend = callback;
      synth.speak(utter);
    }

    function escuchar() {
      if (escuchando) return;
      escuchando = true;
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.interimResults = false;

      recognition.onresult = function(event) {
        escuchando = false;
        const texto = event.results[0][0].transcript;
        agregarMensaje(texto, "user");

        // Simulación de evaluación (respuesta falsa)
        setTimeout(() => {
          const fakeFeedback = "Correcto. ¡Bien hecho!";
          agregarMensaje(fakeFeedback, "bot");
          hablar(fakeFeedback, siguientePregunta);
        }, 1000);
      };

      recognition.onerror = function() {
        escuchando = false;
        agregarMensaje("⚠️ No se entendió tu respuesta. Intenta de nuevo.", "bot");
        hablar("No se entendió tu respuesta. Intenta de nuevo.", siguientePregunta);
      };

      recognition.start();
    }

    function siguientePregunta() {
      indicePregunta++;
      if (indicePregunta >= preguntas.length) {
        agregarMensaje("🎉 ¡Has terminado todas las preguntas!", "bot");
        hablar("Has terminado todas las preguntas. ¡Buen trabajo!");
        return;
      }
      const pregunta = preguntas[indicePregunta];
      agregarMensaje(pregunta, "bot");
      hablar(pregunta, escuchar);
    }

    function comenzarConversacion() {
      indicePregunta = 0;
      document.getElementById("chat").innerHTML = "";
      const primera = preguntas[indicePregunta];
      agregarMensaje(primera, "bot");
      hablar(primera, escuchar);
    }
  </script>
</body>
</html>
